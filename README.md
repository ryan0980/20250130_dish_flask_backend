# 20250130_dish_flask_backend

这是点餐智选助手后端的基础服务，基于 Flask 框架并部署于微信云托管。该服务实现了菜单图片分析、结构化数据返回以及简单的计数器示例 API。

---

## 菜单分析功能概述

在 `wxcloudrun/views.py` 文件中，菜单相关的功能主要集中在以下两个 API 路由中：

### 1. `analyze_menu()`

- **功能**: 分析上传的菜单图片并返回结构化数据。
- **请求方法**: `POST`
- **请求参数**:  
  - `image`: 包含菜单图片的 Base64 编码字符串。

- **处理流程**:
  1. **参数检查**：确认请求体中包含 `image` 参数；若缺失则返回错误响应。
  2. **调试信息打印**：输出 Base64 图片数据的前50个字符以辅助调试。
  3. **初始化 Together 客户端**：使用 API 密钥初始化客户端。
  4. **设置系统提示**：定义系统提示，引导模型解析菜单图片，提取菜单项的名称、描述、价格和类别。
  5. **调用 API**：使用 Together 客户端传入菜单图片和系统提示，获取解析结果。
  6. **结果处理**：将返回的菜单文本按行分割，分类存储到各个类别中，并处理错误情况。
  7. **翻译提示构建**：构建翻译提示，将提取的菜单项翻译成中文，同时保持格式一致。
  8. **调用翻译 API**：使用 Together 客户端调用翻译模型，获取翻译后的菜单数据。
  9. **构建最终结果**：整理翻译后的菜单项，包含处理时间、时间戳、原始文本与翻译文本。
  10. **返回响应**：返回包含结构化菜单分析结果的成功响应。

### 2. `analyze_menu_cloud()`

- **功能**: 从云托管对象存储中获取菜单图片并返回结构化数据。
- **请求方法**: `POST`
- **请求参数**:
  - `fileid`: 云存储中菜单图片的文件 ID。

- **处理流程**:
  1. **参数检查**：确认请求体中包含 `fileid` 参数；若缺失则返回错误响应。
  2. **调试信息打印**：输出接收到的文件 ID，便于调试。
  3. **文件下载**：使用腾讯云 COS SDK 下载指定文件到本地临时路径。
  4. **文件读取与转换**：将下载的图片文件读取并转换为 Base64 编码。
  5. **调用分析函数**：将 Base64 编码后的图片数据传递给 `analyze_menu()` 函数进行菜单分析。

---

## 快速开始

1. **本地调试**  
   下载代码后，参考微信云托管本地调试指南进行调试。

2. **部署**  
   使用 Dockerfile 构建镜像，并部署到微信云托管，确保正确配置环境变量（如 `MYSQL_ADDRESS`、`MYSQL_USERNAME`、`MYSQL_PASSWORD`）。

3. **示例 API 调用**

- **获取计数**  
  ```bash
  curl https://<云托管服务域名>/api/count
  ```

- **更新计数（自增）**  
  ```bash
  curl -X POST -H 'Content-Type: application/json' -d '{"action": "inc"}' https://<云托管服务域名>/api/count
  ```

---

## 前端项目

[前端项目链接占位符](#)



---

## 许可证

本项目采用 [MIT License](LICENSE) 开源。
